name: Trigger OSPF Config via MCP

on:
  workflow_dispatch:
  push:
    paths:
      - 'ospf.json'  # or wherever ChatGPT drops the intent

jobs:
  trigger_mcp:
    runs-on: ubuntu-latest

    env:
      MCP_URL: http://198.11.21.101:8000

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Check if any .cfg exists
        run: |
          if compgen -G "configs/*.cfg" > /dev/null; then
            echo "‚úÖ Found .cfg files."
          else
            echo "‚ùå No .cfg files found. Exiting workflow."
            exit 1
          fi

      - name: Send OSPF JSON to MCP
        run: |
          echo "üì® Sending OSPF configuration request to MCP..."
          curl --max-time 15 -X POST "$MCP_URL/configure/ospf" \
            -H "Content-Type: application/json" \
            --data-binary @ospf.json || true

      - name: Notify on Slack
        run: |
          curl -X POST "$SLACK_WEBHOOK" \
          -H 'Content-type: application/json' \
          --data '{"text":"‚úÖ GitHub Actions pushed the configuration via MCP. Sit back and relax üòå"}'
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}

      - name: Mark job as successful
        run: echo "üéâ Done. GitHub Actions workflow completed successfully."


